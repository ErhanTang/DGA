%macro CreatDS(cyclein, DS); *Macro to import NHANES database from files;
	%let cycle = %substr(&cyclein,2,%eval(%length(&cyclein)-2));		%let path = D:/nhanes/data/;		filename xptIn "&path.&DS..xpt";			libname xptIn xport;
	data SASdata.&DS;	set xptIn.&DS;	run;
%mend creatds;
libname SASdata "D:\CF\data\";

%CreatDS("2011_2012",DR1IFF_G);	%CreatDS("2011_2012",DR2IFF_G);
%CreatDS("2013_2014",DR1IFF_H);	%CreatDS("2013_2014",DR2IFF_H);	%CreatDS("2015_2016",DR1IFF_I);	%CreatDS("2015_2016",DR2IFF_I);
%CreatDS("2017_2020",P_DR1IFF);	%CreatDS("2017_2020",P_DR2IFF);

Data DR1IFF_G;	set SASdata.DR1IFF_G;	SURVEYYR = 14;	DayRec = 1;					Run;	*2011-2012;
Data DR2IFF_G;	set SASdata.DR2IFF_G;	SURVEYYR = 14;	DayRec = 2;					Run;	*2011-2012;
Data DR1IFF_H;	set SASdata.DR1IFF_H;	SURVEYYR = 16;	DR1MC = 0;	DayRec = 1;		Run;	*2013-2014;
Data DR2IFF_H;	set SASdata.DR2IFF_H;	SURVEYYR = 16;	DR1MC = 0;	DayRec = 2;		Run;	*2013-2014;
Data DR1IFF_I;	set SASdata.DR1IFF_I;	SURVEYYR = 18;	DR1MC = 0;	DayRec = 1;		Run;	*2015-2016;
Data DR2IFF_I;	set SASdata.DR2IFF_I;	SURVEYYR = 18;	DR1MC = 0;	DayRec = 2;		Run;	*2015-2016;
Data DR1IFF_P;	set SASdata.P_DR1IFF;	SURVEYYR = 20;	DR1MC = 0;	DayRec = 1;		Run;	*2017-2020;
Data DR2IFF_P;	set SASdata.P_DR2IFF;	SURVEYYR = 20;	DR1MC = 0;	DayRec = 2;		Run;	*2017-2020;


Data DR2IFF_G;	set DR2IFF_G;
	rename DR2ILINE = DR1ILINE	DR2DRSTZ = DR1DRSTZ	DR2IFDCD = DR1IFDCD	DR2MC    = DR1MC 	DR2IGRMS = DR1IGRMS	DR2IKCAL = DR1IKCAL	DR2ISFAT = DR1ISFAT	DR2IMFAT = DR1IMFAT	DR2IPFAT = DR1IPFAT	DR2ISODI = DR1ISODI;
	rename DR2ITFAT = DR1ITFAT	DR2IFIBE = DR1IFIBE DR2ISUGR = DR1ISUGR	DR2ICHOL = DR1ICHOL DR2IATOC = DR1IATOC DR2IATOA = DR1IATOA DR2IRET  = DR1IRET 	DR2IVARA = DR1IVARA DR2IACAR = DR1IACAR DR2IBCAR = DR1IBCAR;
	rename DR2ICRYP = DR1ICRYP	DR2ILYCO = DR1ILYCO DR2ILZ   = DR1ILZ	DR2IVB1  = DR1IVB1	DR2IVB2  = DR1IVB2	DR2INIAC = DR1INIAC DR2IVB6  = DR1IVB6	DR2IFOLA = DR1IFOLA DR2IFA   = DR1IFA	DR2IFF   = DR1IFF;
	rename DR2IFDFE = DR1IFDFE	DR2ICHL  = DR1ICHL	DR2IVB12 = DR1IVB12 DR2IB12A = DR1IB12A DR2IVC   = DR1IVC   DR2IVK   = DR1IVK   DR2ICALC = DR1ICALC DR2IPHOS = DR1IPHOS DR2IMAGN = DR1IMAGN DR2IIRON = DR1IIRON;
	rename DR2IZINC = DR1IZINC	DR2ICOPP = DR1ICOPP DR2IPOTA = DR1IPOTA DR2ISELE = DR1ISELE DR2ICAFF = DR1ICAFF DR2ITHEO = DR1ITHEO DR2IALCO = DR1IALCO;
Run;
Data DR2IFF_H;	set DR2IFF_H;
	rename DR2ILINE = DR1ILINE	DR2DRSTZ = DR1DRSTZ	DR2IFDCD = DR1IFDCD DR2IGRMS = DR1IGRMS	DR2IKCAL = DR1IKCAL	DR2ISFAT = DR1ISFAT	DR2IMFAT = DR1IMFAT	DR2IPFAT = DR1IPFAT	DR2ISODI = DR1ISODI;
	rename DR2ITFAT = DR1ITFAT	DR2IFIBE = DR1IFIBE DR2ISUGR = DR1ISUGR	DR2ICHOL = DR1ICHOL DR2IATOC = DR1IATOC DR2IATOA = DR1IATOA DR2IRET  = DR1IRET 	DR2IVARA = DR1IVARA DR2IACAR = DR1IACAR DR2IBCAR = DR1IBCAR;
	rename DR2ICRYP = DR1ICRYP	DR2ILYCO = DR1ILYCO DR2ILZ   = DR1ILZ	DR2IVB1  = DR1IVB1	DR2IVB2  = DR1IVB2	DR2INIAC = DR1INIAC DR2IVB6  = DR1IVB6	DR2IFOLA = DR1IFOLA DR2IFA   = DR1IFA	DR2IFF   = DR1IFF;
	rename DR2IFDFE = DR1IFDFE	DR2ICHL  = DR1ICHL	DR2IVB12 = DR1IVB12 DR2IB12A = DR1IB12A DR2IVC   = DR1IVC   DR2IVK   = DR1IVK   DR2ICALC = DR1ICALC DR2IPHOS = DR1IPHOS DR2IMAGN = DR1IMAGN DR2IIRON = DR1IIRON;
	rename DR2IZINC = DR1IZINC	DR2ICOPP = DR1ICOPP DR2IPOTA = DR1IPOTA DR2ISELE = DR1ISELE DR2ICAFF = DR1ICAFF DR2ITHEO = DR1ITHEO DR2IALCO = DR1IALCO;
Run;
Data DR2IFF_I;	set DR2IFF_I;
	rename DR2ILINE = DR1ILINE	DR2DRSTZ = DR1DRSTZ	DR2IFDCD = DR1IFDCD DR2IGRMS = DR1IGRMS	DR2IKCAL = DR1IKCAL	DR2ISFAT = DR1ISFAT	DR2IMFAT = DR1IMFAT	DR2IPFAT = DR1IPFAT	DR2ISODI = DR1ISODI;
	rename DR2ITFAT = DR1ITFAT	DR2IFIBE = DR1IFIBE DR2ISUGR = DR1ISUGR	DR2ICHOL = DR1ICHOL DR2IATOC = DR1IATOC DR2IATOA = DR1IATOA DR2IRET  = DR1IRET 	DR2IVARA = DR1IVARA DR2IACAR = DR1IACAR DR2IBCAR = DR1IBCAR;
	rename DR2ICRYP = DR1ICRYP	DR2ILYCO = DR1ILYCO DR2ILZ   = DR1ILZ	DR2IVB1  = DR1IVB1	DR2IVB2  = DR1IVB2	DR2INIAC = DR1INIAC DR2IVB6  = DR1IVB6	DR2IFOLA = DR1IFOLA DR2IFA   = DR1IFA	DR2IFF   = DR1IFF;
	rename DR2IFDFE = DR1IFDFE	DR2ICHL  = DR1ICHL	DR2IVB12 = DR1IVB12 DR2IB12A = DR1IB12A DR2IVC   = DR1IVC   DR2IVK   = DR1IVK   DR2ICALC = DR1ICALC DR2IPHOS = DR1IPHOS DR2IMAGN = DR1IMAGN DR2IIRON = DR1IIRON;
	rename DR2IZINC = DR1IZINC	DR2ICOPP = DR1ICOPP DR2IPOTA = DR1IPOTA DR2ISELE = DR1ISELE DR2ICAFF = DR1ICAFF DR2ITHEO = DR1ITHEO DR2IALCO = DR1IALCO;
Run;
Data DR1IFF_P;	set DR1IFF_P;
	rename WTDR2DPP = WTDR2D;
Run;
Data DR2IFF_P;	set DR2IFF_P;
	rename WTDR2DPP = WTDR2D DR2ILINE = DR1ILINE	DR2DRSTZ = DR1DRSTZ	DR2IFDCD = DR1IFDCD DR2IGRMS = DR1IGRMS	DR2IKCAL = DR1IKCAL	DR2ISFAT = DR1ISFAT	DR2IMFAT = DR1IMFAT	DR2IPFAT = DR1IPFAT	DR2ISODI = DR1ISODI;
	rename DR2ITFAT = DR1ITFAT	DR2IFIBE = DR1IFIBE DR2ISUGR = DR1ISUGR	DR2ICHOL = DR1ICHOL DR2IATOC = DR1IATOC DR2IATOA = DR1IATOA DR2IRET  = DR1IRET 	DR2IVARA = DR1IVARA DR2IACAR = DR1IACAR DR2IBCAR = DR1IBCAR;
	rename DR2ICRYP = DR1ICRYP	DR2ILYCO = DR1ILYCO DR2ILZ   = DR1ILZ	DR2IVB1  = DR1IVB1	DR2IVB2  = DR1IVB2	DR2INIAC = DR1INIAC DR2IVB6  = DR1IVB6	DR2IFOLA = DR1IFOLA DR2IFA   = DR1IFA	DR2IFF   = DR1IFF;
	rename DR2IFDFE = DR1IFDFE	DR2ICHL  = DR1ICHL	DR2IVB12 = DR1IVB12 DR2IB12A = DR1IB12A DR2IVC   = DR1IVC   DR2IVK   = DR1IVK   DR2ICALC = DR1ICALC DR2IPHOS = DR1IPHOS DR2IMAGN = DR1IMAGN DR2IIRON = DR1IIRON;
	rename DR2IZINC = DR1IZINC	DR2ICOPP = DR1ICOPP DR2IPOTA = DR1IPOTA DR2ISELE = DR1ISELE DR2ICAFF = DR1ICAFF DR2ITHEO = DR1ITHEO DR2IALCO = DR1IALCO;
Run;
Proc sort data=DR1IFF_P;		by SEQN DayRec DR1ILINE;	Run;
Proc sort data=DR2IFF_P;		by SEQN DayRec DR1ILINE;	Run;
Data Diet;
	merge DR1IFF_G DR2IFF_G DR1IFF_H DR2IFF_H DR1IFF_I DR2IFF_I DR1IFF_P DR2IFF_P;
	by SEQN DayRec DR1ILINE;
	keep 	SEQN WTDR2D SURVEYYR DayRec DR1ILINE DR1DRSTZ DR1IFDCD DR1MC DR1IGRMS DR1IKCAL DR1ISFAT DR1IMFAT DR1IPFAT DR1ISODI DR1ITFAT DR1IFIBE DR1ISUGR DR1ICHOL DR1IATOC DR1IATOA DR1IRET DR1IVARA DR1IACAR
			DR1IBCAR DR1ICRYP DR1ILYCO DR1IVB1 DR1IVB2 DR1INIAC DR1IVB6 DR1IFOLA DR1IFA DR1IFF DR1IFDFE DR1ICHL DR1IVB12 DR1IB12A DR1IVC DR1IVK DR1ICALC DR1IPHOS DR1IMAGN DR1IIRON DR1IZINC DR1ICOPP DR1IPOTA
			DR1ISELE DR1ICAFF DR1ITHEO DR1IALCO; 
Run;

Proc datasets;	delete DR1IFF_G DR2IFF_G DR1IFF_H DR2IFF_H DR1IFF_I DR2IFF_I DR1IFF_J DR2IFF_J;	Run; Quit;
